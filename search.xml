<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>测试文章</title>
      <link href="//blog/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.html"/>
      <content type="html"><![CDATA[<h1 id="Tomcat8-启动异常"><a href="#Tomcat8-启动异常" class="headerlink" title="Tomcat8 启动异常"></a>Tomcat8 启动异常</h1><a id="more"></a><h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a><em><strong>问题:</strong></em></h2><p> tomcat7/8 启动非常慢</p><h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因:"></a><em><strong>问题原因:</strong></em></h2><p><strong>SHA1PRNG算法是基于SHA-1算法实现且保密性较强的伪随机数生成器</strong>。</p><p><strong>在SHA1PRNG中，有一个种子产生器，它根据配置执行各种操作。</strong></p><p>1）如果Java.security.egd属性或securerandom.source属性指定的是”file:/dev/random”或”file:/dev/urandom”，那么JVM会使用本地种子产生器NativeSeedGenerator，它会调用super()方法，即调用SeedGenerator.URLSeedGenerator(/dev/random)方法进行初始化。</p><p>2）如果java.security.egd属性或securerandom.source属性指定的是其它已存在的URL，那么会调用SeedGenerator.URLSeedGenerator(url)方法进行初始化。</p><p>这就是为什么我们设置值为”file:///dev/urandom”或者值为”file:/./dev/random”都会起作用的原因。</p><p>在这个实现中，产生器会评估熵池（entropy pool）中的噪声数量。随机数是从熵池中进行创建的。当读操作时，/dev/random设备会只返回熵池中噪声的随机字节。/dev/random非常适合那些需要非常高质量随机性的场景，比如一次性的支付或生成密钥的场景。</p><p>当熵池为空时，来自/dev/random的读操作将被阻塞，直到熵池收集到足够的环境噪声数据。这么做的目的是成为一个密码安全的伪随机数发生器，熵池要有尽可能大的输出。对于生成高质量的加密密钥或者是需要长期保护的场景，一定要这么做。</p><p>那么什么是环境噪声？</p><p>随机数产生器会手机来自设备驱动器和其它源的环境噪声数据，并放入熵池中。产生器会评估熵池中的噪声数据的数量。当熵池为空时，这个噪声数据的收集是比较花时间的。这就意味着，Tomcat在生产环境中使用熵池时，会被阻塞较长的时间。</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法:"></a><strong>解决办法:</strong></h2><p>有两种解决办法：</p><p>1）在Tomcat环境中解决</p><p>  可以通过配置JRE使用非阻塞的Entropy Source。</p><p>  在catalina.sh中CATALINA_OPTS加入这么一行：-Djava.security.egd=file:/dev/./urandom 即可。</p><p>  加入后再启动Tomcat</p><p>2）在JVM环境中解决</p><p>  打开$JAVA_PATH/jre/lib/security/java.security这个文件，找到下面的内容：</p><p>  securerandom.source=file:/dev/urandom </p><p>  替换成</p><p>  securerandom.source=file:/dev/./urandom</p><hr><h1 id="Tomcat-报错"><a href="#Tomcat-报错" class="headerlink" title="Tomcat 报错"></a>Tomcat 报错</h1><h2 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a><strong>错误信息</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error occurred during initialization of VM</span><br><span class="line">Too small initial heap <span class="keyword">for</span> new size specified</span><br></pre></td></tr></table></figure><h3 id="错误详解"><a href="#错误详解" class="headerlink" title="错误详解"></a><strong>错误详解</strong></h3><ol><li>错误信息有误导，不一定是堆内存大小设置不够</li><li>Xms可以设置与-Xmx相同，但是最好别把三个都设置一样</li></ol><h3 id="报错原因"><a href="#报错原因" class="headerlink" title="报错原因"></a><strong>报错原因</strong></h3><p><strong>对xmn理解错误(Xmn不能大于等于Xmx)</strong></p><blockquote><p>-Xmn2g ：设置年轻代大小为2G。整个堆大小=年轻代大小 + 年老代大小 + 持久代大小 。持久代一般固定大小为64m，所以增大年轻代后，将会减小年老代大小。此值对系统性能影响较大，Sun官方推荐配置为整个堆的3/8。</p></blockquote><hr><h1 id="Tomcat-日志排查"><a href="#Tomcat-日志排查" class="headerlink" title="Tomcat 日志排查"></a>Tomcat 日志排查</h1><p><strong>开启 debug 模式进行深层次的排错</strong></p><ol><li>${tomcat_home}/lib/logging.properties # 创建该文件</li><li><p>添加如下内容</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">handlers = org.apache.juli.FileHandler, java.util.logging.ConsoleHandler</span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment"># Handler specific properties.</span></span><br><span class="line"><span class="comment"># Describes specific configuration info for Handlers.</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"></span><br><span class="line">org.apache.juli.FileHandler.level = FINE</span><br><span class="line">org.apache.juli.FileHandler.directory = <span class="variable">$&#123;catalina.base&#125;</span>/logs</span><br><span class="line">org.apache.juli.FileHandler.prefix = error-debug.</span><br><span class="line"></span><br><span class="line">java.util.logging.ConsoleHandler.level = FINE</span><br><span class="line">java.util.logging.ConsoleHandler.formatter = java.util.logging.SimpleFormatter</span><br></pre></td></tr></table></figure></li><li><p>查看${tomcat_home}/logs/error……</p></li></ol><hr><h1 id="Tomcat-黑白名单"><a href="#Tomcat-黑白名单" class="headerlink" title="Tomcat 黑白名单"></a>Tomcat 黑白名单</h1><p><em><strong>Tomcat 配置文件更改</strong></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat $&#123;tomcat_home&#125;/config/server.conf</span></span><br><span class="line">&lt;Context crossContext=<span class="string">"true"</span> docBase=<span class="string">"/software/deploy_jenkins/jenkins"</span> reloadable=<span class="string">"true"</span> allowLinking=<span class="string">"true"</span> path=<span class="string">""</span>&gt;</span><br><span class="line">    &lt;Valve className=<span class="string">"org.apache.catalina.valves.RemoteAddrValve"</span> allow=<span class="string">"10.200.200.91"</span> deny=<span class="string">""</span>/&gt;</span><br><span class="line">&lt;/Context&gt;</span><br></pre></td></tr></table></figure><h1 id="Tomcat-流量转换"><a href="#Tomcat-流量转换" class="headerlink" title="Tomcat 流量转换"></a>Tomcat 流量转换</h1><blockquote><p>HTTP 转 HTTPS( 在证书存在负载均衡端)</p></blockquote><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Make Tomcat Understand X-Forwarded-Proto by adding the following text in the Tomcat server.xml  &lt;Engine&gt; section. You only need to change this if you are using the shared Jelastic SSL certificate or if you are using a load balancer.</span><br><span class="line"></span><br><span class="line">&lt;Valve className=&quot;org.apache.catalina.valves.RemoteIpValve&quot;</span><br><span class="line">remoteIpHeader=&quot;x-forwarded-for&quot;</span><br><span class="line">protocolHeader=&quot;x-forwarded-proto&quot;</span><br><span class="line">protocolHeaderHttpsValue=&quot;https&quot; /&gt;</span><br></pre></td></tr></table></figure><h1 id="Tomcat代理配置"><a href="#Tomcat代理配置" class="headerlink" title="Tomcat代理配置"></a>Tomcat代理配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># catalina.sh JAVA_OPT=添加如下</span></span><br><span class="line">-Dhttp.proxyHost=192.168.0.9 -Dhttp.proxyPort=37128</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Hello World</title>
      <link href="//blog/hello-world.html"/>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
    </entry>
    
  
  
</search>
